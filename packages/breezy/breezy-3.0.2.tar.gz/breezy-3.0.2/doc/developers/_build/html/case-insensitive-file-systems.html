
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Case Insensitive File Systems &#8212; Breezy 3.0.2dev documentation</title>
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>

    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Development repository formats" href="development-repo.html" />
    <link rel="prev" title="Repository Streams" href="repository-stream.html" />
<link rel="stylesheet" href="_static/brz-doc.css" type="text/css" />
 
  </head><body>
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="index.html">Developer Document Catalog (3.0.2dev)</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="repository-stream.html" title="Repository Streams"
             accesskey="P">previous</a> |
          <a href="development-repo.html" title="Development repository formats"
             accesskey="N">next</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="case-insensitive-file-systems">
<h1>Case Insensitive File Systems<a class="headerlink" href="#case-insensitive-file-systems" title="Permalink to this headline">¶</a></h1>
<p>Bazaar must be portable across operating-systems and file-systems.  While the
primary file-system for an operating-system might have some particular
characteristics, it’s not necessary that <em>all</em> file-systems for that
operating-system will have the same characteristics.</p>
<p>For example, the FAT32 file-system is most commonly found on Windows operating
systems, and has the characteristics usually associated with a Windows
file-system.  However, USB devices means FAT32 file-systems are often used
with GNU/Linux systems, so the current operating system doesn’t necessarily reflect the
capabilities of the file-system.</p>
<p>Bazaar supports 3 kinds of file-systems, each to different degrees.</p>
<ul class="simple">
<li><p>Case-sensitive file-systems: This is the file-system generally used on
GNU/Linux: 2 files can differ only by case, and the exact case must be used
when opening a file.</p></li>
<li><p>Case-insensitive, case-preserving (cicp) file-systems: This is the
file-system generally used on Windows; FAT32 is an example of such a
file-system.  Although existing files can be opened using any case, the
exact case used to create the file is preserved and available for programs
to query.  Two files that differ only by case is not allowed.</p></li>
<li><p>Case-insensitive: This is the file-system used by very old Windows versions
and is rarely encountered “in the wild”.  Two files that differ only by
case is not allowed and the case used to create a file is not preserved.</p></li>
</ul>
<p>As can be implied by the above descriptions, only the first two are considered
relevant to a modern Bazaar.</p>
<p>For more details, including use cases, please see
<a class="reference external" href="http://wiki.bazaar.canonical.com/CasePreservingWorkingTreeUseCases">http://wiki.bazaar.canonical.com/CasePreservingWorkingTreeUseCases</a></p>
<div class="section" id="handling-these-file-systems">
<h2>Handling these file-systems<a class="headerlink" href="#handling-these-file-systems" title="Permalink to this headline">¶</a></h2>
<p>The fundamental problem handling these file-systems is that the user may
specify a file name or inventory item with an “incorrect” case - where
“incorrect” simply means different than what is stored - from the user’s
point-of-view, the filename is still correct, as it can be used to open, edit
delete etc the item.</p>
<p>The approach Bazaar takes is to “fixup” each of the command-line arguments
which refer to a filename or an inventory item - where “fixup” means to
adjust the case specified by the user so it exactly matches an existing item.</p>
<p>There are two places this match can be performed against - the file-system
and the Bazaar inventory.  When looking at a case-insensitive file-system, it
is impossible to have 2 names that differ only by case, so there is no
ambiguity. The inventory doesn’t have the same rules, but it is expected that
projects which wish to work with Windows would, by convention, avoid filenames
that differ only by case.</p>
<p>The rules for such fixups turn out to be quite simple:</p>
<ul class="simple">
<li><p>If an argument refers to an existing inventory item, we fixup the argument
using the inventory.  This is, basically, all commands that take a filename
or directory argument <em>other</em> than ‘add’ and in some cases ‘mv’</p></li>
<li><p>If an argument refers to an existing filename for the creation of an
inventory item (eg, add), then the case of the existing file on the disk
will be used.  However, Bazaar must still check the inventory to prevent
accidentally creating 2 inventory items that differ only by case.</p></li>
<li><p>If an argument results in the creation of a <em>new</em> filename (eg, a move
destination), the argument will be used as specified.  Breezy will create
a file and inventory item that exactly matches the case specified (although
as above, care must be taken to avoid creating two inventory items that
differ only by case.)</p></li>
</ul>
</div>
<div class="section" id="implementation-of-support-for-these-file-systems">
<h2>Implementation of support for these file-systems<a class="headerlink" href="#implementation-of-support-for-these-file-systems" title="Permalink to this headline">¶</a></h2>
<p>From the description above, it can be seen the implementation is fairly
simple and need not intrude on the internals of Bazaar too much; most of
the time it is simply converting a string specified by the user to the
“canonical” form as stored in either the inventory or filesystem.  These
boil down to the following new API functions:</p>
<ul class="simple">
<li><p>osutils.canonical_relpath() - like osutils.relpath() but adjust the case
of the result to match any existing items.</p></li>
<li><p>Tree.get_canonical_inventory_path - somewhat like Tree.get_symlink_target(),
Tree.get_file() etc; returns a name with the case adjusted to match
existing inventory items.</p></li>
<li><p>osutils.canonical_relpaths() and Tree.get_canonical_inventory_paths() - like
the ‘singular’ versions above, but accept and return sequences and therefore
offer more optimization opportunities when working with multiple names.</p></li>
</ul>
<p>The only complication is the requirement that Bazaar not allow the creation
of items that differ only by case on such file-systems.  For this requirement,
case-insensitive and cicp file-systems can be treated the same.  The
‘case_sensitive’ attribute on a MutableTree is used to control this behaviour.</p>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table of Contents</h3>
          <ul>
<li class="toctree-l1"><a class="reference internal" href="contribution-quickstart.html">Contributing to Breezy</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="profiling.html">Profiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="bug-handling.html">Tracking Bugs in Breezy</a></li>
<li class="toctree-l1"><a class="reference internal" href="HACKING.html">Breezy Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Breezy Testing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-review.html">Reviewing proposed changes to Breezy</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-style.html">Breezy Code Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="documenting-changes.html">Documenting Changes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuring Breezy</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html#breezy-conf">breezy.conf</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html#location-conf">location.conf</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html#branch-conf">branch.conf</a></li>
<li class="toctree-l1"><a class="reference internal" href="fetch.html">Fetching data</a></li>
<li class="toctree-l1"><a class="reference internal" href="transports.html">Developer guide to breezy transports</a></li>
<li class="toctree-l1"><a class="reference internal" href="ui.html">Interacting with the user</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="releasing.html">Releasing Breezy</a></li>
<li class="toctree-l1"><a class="reference internal" href="ppa.html">Managing the Breezy PPA</a></li>
<li class="toctree-l1"><a class="reference internal" href="ec2.html">Breezy Windows EC2 Server</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Breezy Architectural Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="integration.html">Integrating with Breezy</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="principles.html">Breezy Design Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="specifications.html">Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="implementation-notes.html">Implementation notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="miscellaneous-notes.html">Miscellaneous notes</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
            </form>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="repository-stream.html" title="Repository Streams"
              >previous</a> |
            <a href="development-repo.html" title="Development repository formats"
              >next</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="_sources/case-insensitive-file-systems.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2009-2011 Canonical Ltd, 2017-2018 Breezy Developers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>