
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Breezy Code Style Guide &#8212; Breezy 3.0.2dev documentation</title>
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>

    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Documenting Changes" href="documenting-changes.html" />
    <link rel="prev" title="Reviewing proposed changes to Breezy" href="code-review.html" />
<link rel="stylesheet" href="_static/brz-doc.css" type="text/css" />
 
  </head><body>
    <div class="header-wrapper" role="banner">
      <div class="header">
        <div class="headertitle"><a
          href="index.html">Developer Document Catalog (3.0.2dev)</a></div>
        <div class="rel" role="navigation" aria-label="related navigation">
          <a href="code-review.html" title="Reviewing proposed changes to Breezy"
             accesskey="P">previous</a> |
          <a href="documenting-changes.html" title="Documenting Changes"
             accesskey="N">next</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="breezy-code-style-guide">
<h1>Breezy Code Style Guide<a class="headerlink" href="#breezy-code-style-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="code-layout">
<h2>Code layout<a class="headerlink" href="#code-layout" title="Permalink to this headline">¶</a></h2>
<p>Please write <a class="reference external" href="http://www.python.org/peps/pep-0008.html">PEP-8</a> compliant code.</p>
<p>One often-missed requirement is that the first line of docstrings
should be a self-contained one-sentence summary.</p>
<p>We use 4 space indents for blocks, and never use tab characters.  (In vim,
<code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">expandtab</span></code>.)</p>
<p>Trailing white space should be avoided, but is allowed.
You should however not make lots of unrelated white space changes.</p>
<p>Unix style newlines (LF) are used.</p>
<p>Each file must have a newline at the end of it.</p>
<p>Lines should be no more than 79 characters if at all possible.
Lines that continue a long statement may be indented in either of
two ways:</p>
<p>within the parenthesis or other character that opens the block, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_long_method</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span>
               <span class="n">arg2</span><span class="p">,</span>
               <span class="n">arg3</span><span class="p">)</span>
</pre></div>
</div>
<p>or indented by four spaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_long_method</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span>
    <span class="n">arg2</span><span class="p">,</span>
    <span class="n">arg3</span><span class="p">)</span>
</pre></div>
</div>
<p>The first is considered clearer by some people; however it can be a bit
harder to maintain (e.g. when the method name changes), and it does not
work well if the relevant parenthesis is already far to the right.  Avoid
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">legbone</span><span class="o">.</span><span class="n">kneebone</span><span class="o">.</span><span class="n">shinbone</span><span class="o">.</span><span class="n">toebone</span><span class="o">.</span><span class="n">shake_it</span><span class="p">(</span><span class="n">one</span><span class="p">,</span>
                                                <span class="n">two</span><span class="p">,</span>
                                                <span class="n">three</span><span class="p">)</span>
</pre></div>
</div>
<p>but rather</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">legbone</span><span class="o">.</span><span class="n">kneebone</span><span class="o">.</span><span class="n">shinbone</span><span class="o">.</span><span class="n">toebone</span><span class="o">.</span><span class="n">shake_it</span><span class="p">(</span><span class="n">one</span><span class="p">,</span>
    <span class="n">two</span><span class="p">,</span>
    <span class="n">three</span><span class="p">)</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">legbone</span><span class="o">.</span><span class="n">kneebone</span><span class="o">.</span><span class="n">shinbone</span><span class="o">.</span><span class="n">toebone</span><span class="o">.</span><span class="n">shake_it</span><span class="p">(</span>
    <span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">,</span> <span class="n">three</span><span class="p">)</span>
</pre></div>
</div>
<p>For long lists, we like to add a trailing comma and put the closing
character on the following line.  This makes it easier to add new items in
future:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">breezy.goo</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">jam</span><span class="p">,</span>
    <span class="n">jelly</span><span class="p">,</span>
    <span class="n">marmalade</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>There should be spaces between function parameters, but not between the
keyword name and the value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">call</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">cheese</span><span class="o">=</span><span class="n">quark</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="python-versions">
<h2>Python versions<a class="headerlink" href="#python-versions" title="Permalink to this headline">¶</a></h2>
<p>Breezy supports Python 2.7 and Python 3.5 or later.</p>
</div>
<div class="section" id="hasattr-and-getattr">
<h2>hasattr and getattr<a class="headerlink" href="#hasattr-and-getattr" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">hasattr</span></code> should not be used because it swallows exceptions including
<code class="docutils literal notranslate"><span class="pre">KeyboardInterrupt</span></code>.  Instead, say something like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="section" id="kwargs">
<h2>kwargs<a class="headerlink" href="#kwargs" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> in the prototype of a function should be used sparingly.
It can be good on higher-order functions that decorate other functions,
such as <code class="docutils literal notranslate"><span class="pre">addCleanup</span></code> or <code class="docutils literal notranslate"><span class="pre">assertRaises</span></code>, or on functions that take only
(or almost only) kwargs, where any kwargs can be passed.</p>
<p>Otherwise, be careful: if the parameters to a function are a bit complex
and might vary over time (e.g.  the <code class="docutils literal notranslate"><span class="pre">commit</span></code> API) then we prefer to pass an
object rather than a bag of positional and/or keyword args.  If you have
an arbitrary set of keys and values that are different with each use (e.g.
string interpolation inputs) then again that should not be mixed in with
the regular positional/keyword args, it seems like a different category of
thing.</p>
</div>
<div class="section" id="imitating-standard-objects">
<h2>Imitating standard objects<a class="headerlink" href="#imitating-standard-objects" title="Permalink to this headline">¶</a></h2>
<p>Don’t provide methods that imitate built-in classes (eg <code class="docutils literal notranslate"><span class="pre">__in__</span></code>,
<code class="docutils literal notranslate"><span class="pre">__call__</span></code>, <code class="docutils literal notranslate"><span class="pre">__int__</span></code>, <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>) unless the class you’re
implementing really does act like the builtin class, in semantics and
performance.</p>
<p>For example, old code lets you say <code class="docutils literal notranslate"><span class="pre">file_id</span> <span class="pre">in</span> <span class="pre">inv</span></code> but we no longer
consider this good style.  Instead, say more explicitly
<code class="docutils literal notranslate"><span class="pre">inv.has_id(file_id)</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">__repr__</span></code>, <code class="docutils literal notranslate"><span class="pre">__cmp__</span></code>, <code class="docutils literal notranslate"><span class="pre">__str__</span></code> are usually fine.</p>
</div>
<div class="section" id="module-imports">
<h2>Module Imports<a class="headerlink" href="#module-imports" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Imports should be done at the top-level of the file, unless there is
a strong reason to have them lazily loaded when a particular
function runs.  Import statements have a cost, so try to make sure
they don’t run inside hot functions.</p></li>
<li><p>Module names should always be given fully-qualified,
i.e. <code class="docutils literal notranslate"><span class="pre">breezy.hashcache</span></code> not just <code class="docutils literal notranslate"><span class="pre">hashcache</span></code>.</p></li>
</ul>
</div>
<div class="section" id="naming">
<h2>Naming<a class="headerlink" href="#naming" title="Permalink to this headline">¶</a></h2>
<p>Functions, methods or members that are relatively private are given
a leading underscore prefix.  Names without a leading underscore are
public not just across modules but to programmers using breezy as an
API.</p>
<p>We prefer class names to be concatenated capital words (<code class="docutils literal notranslate"><span class="pre">TestCase</span></code>)
and variables, methods and functions to be lowercase words joined by
underscores (<code class="docutils literal notranslate"><span class="pre">revision_id</span></code>, <code class="docutils literal notranslate"><span class="pre">get_revision</span></code>).</p>
<p>For the purposes of naming some names are treated as single compound
words: “filename”, “revno”.</p>
<p>Consider naming classes as nouns and functions/methods as verbs.</p>
<p>Try to avoid using abbreviations in names, because there can be
inconsistency if other people use the full name.</p>
</div>
<div class="section" id="standard-names">
<h2>Standard Names<a class="headerlink" href="#standard-names" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">revision_id</span></code> not <code class="docutils literal notranslate"><span class="pre">rev_id</span></code> or <code class="docutils literal notranslate"><span class="pre">revid</span></code></p>
<p>Functions that transform one thing to another should be named <code class="docutils literal notranslate"><span class="pre">x_to_y</span></code>
(not <code class="docutils literal notranslate"><span class="pre">x2y</span></code> as occurs in some old code.)</p>
</div>
<div class="section" id="destructors">
<h2>Destructors<a class="headerlink" href="#destructors" title="Permalink to this headline">¶</a></h2>
<p>Python destructors (<code class="docutils literal notranslate"><span class="pre">__del__</span></code>) work differently to those of other
languages.  In particular, bear in mind that destructors may be called
immediately when the object apparently becomes unreferenced, or at some
later time, or possibly never at all.  Therefore we have restrictions on
what can be done inside them.</p>
<ol class="arabic simple" start="0">
<li><p>If you think you need to use a <code class="docutils literal notranslate"><span class="pre">__del__</span></code> method ask another
developer for alternatives.  If you do need to use one, explain
why in a comment.</p></li>
<li><p>Never rely on a <code class="docutils literal notranslate"><span class="pre">__del__</span></code> method running.  If there is code that
must run, instead have a <code class="docutils literal notranslate"><span class="pre">finally</span></code> block or an <code class="docutils literal notranslate"><span class="pre">addCleanup</span></code> call an
explicit <code class="docutils literal notranslate"><span class="pre">close</span></code> method.</p></li>
<li><p>Never <code class="docutils literal notranslate"><span class="pre">import</span></code> from inside a <code class="docutils literal notranslate"><span class="pre">__del__</span></code> method, or you may crash the
interpreter!!</p></li>
<li><p>Prior to bzr 2.4, we sometimes used to raise warnings from del methods
that the object was not cleaned up or closed.  We no longer do this:
failure to close the object doesn’t cause a test failure; the warning
appears an arbitrary long time after the problem occurred (the object
being leaked); merely having a del method inhibits Python gc; the
warnings appear to users and upset them; they can also break tests that
are checking what appears on stderr.</p></li>
</ol>
<p>In short, just don’t use <code class="docutils literal notranslate"><span class="pre">__del__</span></code>.</p>
</div>
<div class="section" id="cleanup-methods">
<h2>Cleanup methods<a class="headerlink" href="#cleanup-methods" title="Permalink to this headline">¶</a></h2>
<p>Often when something has failed later code will fail too, including
cleanups invoked from <code class="docutils literal notranslate"><span class="pre">finally</span></code> blocks.  These secondary failures are
generally uninteresting compared to the original exception.  <code class="docutils literal notranslate"><span class="pre">breezy</span></code>
has some facilities you can use to mitigate this.</p>
<ul>
<li><p>In <code class="docutils literal notranslate"><span class="pre">Command</span></code> subclasses, prefer the <code class="docutils literal notranslate"><span class="pre">add_cleanup</span></code> method to using
<code class="docutils literal notranslate"><span class="pre">try</span></code>/<code class="docutils literal notranslate"><span class="pre">finally</span></code> blocks.  E.g. to acquire a lock and ensure it will
always be released when the command is done:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">add_cleanup</span><span class="p">(</span><span class="n">branch</span><span class="o">.</span><span class="n">lock_read</span><span class="p">()</span><span class="o">.</span><span class="n">unlock</span><span class="p">)</span>
</pre></div>
</div>
<p>This also avoids heavily indented code. It also makes it easier to notice
mismatched lock/unlock pairs (and other kinds of resource
acquire/release) because there isn’t a large block of code separating
them.</p>
</li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">only_raises</span></code> decorator (from <code class="docutils literal notranslate"><span class="pre">breezy.decorators</span></code>) when
defining methods that are typically called in <code class="docutils literal notranslate"><span class="pre">finally</span></code> blocks, such
as <code class="docutils literal notranslate"><span class="pre">unlock</span></code> methods.  For example, <code class="docutils literal notranslate"><span class="pre">&#64;only_raises(LockNotHeld,</span>
<span class="pre">LockBroken)</span></code>.  All errors that are unlikely to be a knock-on failure
from a previous failure should be allowed.</p></li>
<li><p>Consider using the <code class="docutils literal notranslate"><span class="pre">OperationWithCleanups</span></code> helper from
<code class="docutils literal notranslate"><span class="pre">breezy.cleanup</span></code> anywhere else you have a <code class="docutils literal notranslate"><span class="pre">finally</span></code> block that
might fail.</p></li>
</ul>
</div>
<div class="section" id="factories">
<h2>Factories<a class="headerlink" href="#factories" title="Permalink to this headline">¶</a></h2>
<p>In some places we have variables which point to callables that construct
new instances.  That is to say, they can be used a lot like class objects,
but they shouldn’t be <em>named</em> like classes.  Things called <code class="docutils literal notranslate"><span class="pre">FooBar</span></code> should
create an instance of <code class="docutils literal notranslate"><span class="pre">FooBar</span></code>.  A factory method that might create a
<code class="docutils literal notranslate"><span class="pre">FooBar</span></code> or might make something else should be called <code class="docutils literal notranslate"><span class="pre">foo_factory</span></code>.</p>
</div>
<div class="section" id="registries">
<h2>Registries<a class="headerlink" href="#registries" title="Permalink to this headline">¶</a></h2>
<p>Several places in Breezy use (or will use) a registry, which is a
mapping from names to objects or classes.  The registry allows for
loading in registered code only when it’s needed, and keeping
associated information such as a help string or description.</p>
</div>
<div class="section" id="interobject-and-multiple-dispatch">
<h2>InterObject and multiple dispatch<a class="headerlink" href="#interobject-and-multiple-dispatch" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">InterObject</span></code> provides for two-way <a class="reference external" href="http://en.wikipedia.org/wiki/Multiple_dispatch">multiple dispatch</a>: matching
up for example a source and destination repository to find the right way
to transfer data between them.</p>
<p>There is a subclass <code class="docutils literal notranslate"><span class="pre">InterObject</span></code> classes for each type of object that is
dispatched this way, e.g. <code class="docutils literal notranslate"><span class="pre">InterRepository</span></code>.  Calling <code class="docutils literal notranslate"><span class="pre">.get()</span></code> on this
class will return an <code class="docutils literal notranslate"><span class="pre">InterObject</span></code> instance providing the best match for
those parameters, and this instance then has methods for operations
between the objects.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inter</span> <span class="o">=</span> <span class="n">InterRepository</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">source_repo</span><span class="p">,</span> <span class="n">target_repo</span><span class="p">)</span>
<span class="n">inter</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">revision_id</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">InterRepository</span></code> also acts as a registry-like object for its
subclasses, and they can be added through <code class="docutils literal notranslate"><span class="pre">.register_optimizer</span></code>.  The
right one to run is selected by asking each class, in reverse order of
registration, whether it <code class="docutils literal notranslate"><span class="pre">.is_compatible</span></code> with the relevant objects.</p>
</div>
<div class="section" id="lazy-imports">
<h2>Lazy Imports<a class="headerlink" href="#lazy-imports" title="Permalink to this headline">¶</a></h2>
<p>To make startup time faster, we use the <code class="docutils literal notranslate"><span class="pre">breezy.lazy_import</span></code> module to
delay importing modules until they are actually used. <code class="docutils literal notranslate"><span class="pre">lazy_import</span></code> uses
the same syntax as regular python imports. So to import a few modules in a
lazy fashion do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">breezy.lazy_import</span> <span class="k">import</span> <span class="n">lazy_import</span>
<span class="n">lazy_import</span><span class="p">(</span><span class="nb">globals</span><span class="p">(),</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">import os</span>
<span class="s2">import subprocess</span>
<span class="s2">import sys</span>
<span class="s2">import time</span>

<span class="s2">from breezy import (</span>
<span class="s2">   errors,</span>
<span class="s2">   transport,</span>
<span class="s2">   revision as _mod_revision,</span>
<span class="s2">   )</span>
<span class="s2">import breezy.transport</span>
<span class="s2">import breezy.xml5</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>At this point, all of these exist as a <code class="docutils literal notranslate"><span class="pre">ImportReplacer</span></code> object, ready to
be imported once a member is accessed. Also, when importing a module into
the local namespace, which is likely to clash with variable names, it is
recommended to prefix it as <code class="docutils literal notranslate"><span class="pre">_mod_&lt;module&gt;</span></code>. This makes it clearer that
the variable is a module, and these object should be hidden anyway, since
they shouldn’t be imported into other namespaces.</p>
<p>While it is possible for <code class="docutils literal notranslate"><span class="pre">lazy_import()</span></code> to import members of a module
when using the <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">member</span></code> syntax, it is recommended to
only use that syntax to load sub modules <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">module</span> <span class="pre">import</span> <span class="pre">submodule</span></code>.
This is because variables and classes can frequently be used without
needing a sub-member for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lazy_import</span><span class="p">(</span><span class="nb">globals</span><span class="p">(),</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">from module import MyClass</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MyClass</span><span class="p">)</span>
</pre></div>
</div>
<p>This will incorrectly fail, because <code class="docutils literal notranslate"><span class="pre">MyClass</span></code> is a <code class="docutils literal notranslate"><span class="pre">ImportReplacer</span></code>
object, rather than the real class.</p>
<p>It also is incorrect to assign <code class="docutils literal notranslate"><span class="pre">ImportReplacer</span></code> objects to other variables.
Because the replacer only knows about the original name, it is unable to
replace other variables. The <code class="docutils literal notranslate"><span class="pre">ImportReplacer</span></code> class will raise an
<code class="docutils literal notranslate"><span class="pre">IllegalUseOfScopeReplacer</span></code> exception if it can figure out that this
happened. But it requires accessing a member more than once from the new
variable, so some bugs are not detected right away.</p>
</div>
<div class="section" id="the-null-revision">
<h2>The Null revision<a class="headerlink" href="#the-null-revision" title="Permalink to this headline">¶</a></h2>
<p>The null revision is the ancestor of all revisions.  Its revno is 0, its
revision-id is <code class="docutils literal notranslate"><span class="pre">null:</span></code>, and its tree is the empty tree.  When referring
to the null revision, please use <code class="docutils literal notranslate"><span class="pre">breezy.revision.NULL_REVISION</span></code>.  Old
code sometimes uses <code class="docutils literal notranslate"><span class="pre">None</span></code> for the null revision, but this practice is
being phased out.</p>
</div>
<div class="section" id="object-string-representations">
<h2>Object string representations<a class="headerlink" href="#object-string-representations" title="Permalink to this headline">¶</a></h2>
<p>Python prints objects using their <code class="docutils literal notranslate"><span class="pre">__repr__</span></code> method when they are
written to logs, exception tracebacks, or the debugger.  We want
objects to have useful representations to help in determining what went
wrong.</p>
<p>If you add a new class you should generally add a <code class="docutils literal notranslate"><span class="pre">__repr__</span></code> method
unless there is an adequate method in a parent class.  There should be a
test for the repr.</p>
<p>Representations should typically look like Python constructor syntax, but
they don’t need to include every value in the object and they don’t need
to be able to actually execute.  They’re to be read by humans, not
machines.  Don’t hardcode the classname in the format, so that we get the
correct value if the method is inherited by a subclass.  If you’re
printing attributes of the object, including strings, you should normally
use <code class="docutils literal notranslate"><span class="pre">%r</span></code> syntax (to call their repr in turn).</p>
<p>Try to avoid the representation becoming more than one or two lines long.
(But balance this against including useful information, and simplicity of
implementation.)</p>
<p>Because repr methods are often called when something has already gone
wrong, they should be written somewhat more defensively than most code.
They shouldn’t have side effects like doing network or disk
IO.
The object may be half-initialized or in some other way in an illegal
state.  The repr method shouldn’t raise an exception, or it may hide the
(probably more useful) underlying exception.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%r</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="exception-handling">
<h2>Exception handling<a class="headerlink" href="#exception-handling" title="Permalink to this headline">¶</a></h2>
<p>A bare <code class="docutils literal notranslate"><span class="pre">except</span></code> statement will catch all exceptions, including ones that
really should terminate the program such as <code class="docutils literal notranslate"><span class="pre">MemoryError</span></code> and
<code class="docutils literal notranslate"><span class="pre">KeyboardInterrupt</span></code>.  They should rarely be used unless the exception is
later re-raised.  Even then, think about whether catching just
<code class="docutils literal notranslate"><span class="pre">Exception</span></code> (which excludes system errors in Python2.5 and later) would
be better.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">__str__</span></code> method on exceptions should be small and have no side
effects, following the rules given for <a class="reference internal" href="#object-string-representations">Object string representations</a>.
In particular it should not do any network IO, or complicated
introspection of other objects.  All the state needed to present the
exception to the user should be gathered before the error is raised.
In other words, exceptions should basically be value objects.</p>
</div>
<div class="section" id="test-coverage">
<h2>Test coverage<a class="headerlink" href="#test-coverage" title="Permalink to this headline">¶</a></h2>
<p>All code should be exercised by the test suite.  See the <a class="reference external" href="http://www.breezy-vcs.org/developers/testing.html">Breezy Testing
Guide</a> for detailed
information about writing tests.</p>
</div>
<div class="section" id="assertions">
<h2>Assertions<a class="headerlink" href="#assertions" title="Permalink to this headline">¶</a></h2>
<p>Do not use the Python <code class="docutils literal notranslate"><span class="pre">assert</span></code> statement, either in tests or elsewhere.
A source test checks that it is not used.  It is ok to explicitly raise
AssertionError.</p>
<p>Rationale:</p>
<ul class="simple">
<li><p>It makes the behaviour vary depending on whether brz is run with -O
or not, therefore giving a chance for bugs that occur in one case or
the other, several of which have already occurred: assertions with
side effects, code which can’t continue unless the assertion passes,
cases where we should give the user a proper message rather than an
assertion failure.</p></li>
<li><p>It’s not that much shorter than an explicit if/raise.</p></li>
<li><p>It tends to lead to fuzzy thinking about whether the check is
actually needed or not, and whether it’s an internal error or not</p></li>
<li><p>It tends to cause look-before-you-leap patterns.</p></li>
<li><p>It’s unsafe if the check is needed to protect the integrity of the
user’s data.</p></li>
<li><p>It tends to give poor messages since the developer can get by with
no explanatory text at all.</p></li>
<li><p>We can’t rely on people always running with -O in normal use, so we
can’t use it for tests that are actually expensive.</p></li>
<li><p>Expensive checks that help developers are better turned on from the
test suite or a -D flag.</p></li>
<li><p>If used instead of <code class="docutils literal notranslate"><span class="pre">self.assert*()</span></code> in tests it makes them falsely
pass with -O.</p></li>
</ul>
</div>
<div class="section" id="emacs-setup">
<h2>emacs setup<a class="headerlink" href="#emacs-setup" title="Permalink to this headline">¶</a></h2>
<p>In emacs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">;(</span><span class="n">defface</span> <span class="n">my</span><span class="o">-</span><span class="n">invalid</span><span class="o">-</span><span class="n">face</span>
<span class="p">;</span>  <span class="s1">&#39;((t (:background &quot;Red&quot; :underline t)))</span>
<span class="p">;</span>  <span class="s2">&quot;Face used to highlight invalid constructs or other uglyties&quot;</span>
<span class="p">;</span>  <span class="p">)</span>

<span class="p">(</span><span class="n">defun</span> <span class="n">my</span><span class="o">-</span><span class="n">python</span><span class="o">-</span><span class="n">mode</span><span class="o">-</span><span class="n">hook</span> <span class="p">()</span>
 <span class="p">;;</span> <span class="n">setup</span> <span class="n">preferred</span> <span class="n">indentation</span> <span class="n">style</span><span class="o">.</span>
 <span class="p">(</span><span class="n">setq</span> <span class="n">fill</span><span class="o">-</span><span class="n">column</span> <span class="mi">79</span><span class="p">)</span>
 <span class="p">(</span><span class="n">setq</span> <span class="n">indent</span><span class="o">-</span><span class="n">tabs</span><span class="o">-</span><span class="n">mode</span> <span class="n">nil</span><span class="p">)</span> <span class="p">;</span> <span class="n">no</span> <span class="n">tabs</span><span class="p">,</span> <span class="n">never</span><span class="p">,</span> <span class="n">I</span> <span class="n">will</span> <span class="ow">not</span> <span class="n">repeat</span>
<span class="p">;</span>  <span class="p">(</span><span class="n">font</span><span class="o">-</span><span class="n">lock</span><span class="o">-</span><span class="n">add</span><span class="o">-</span><span class="n">keywords</span> <span class="s1">&#39;python-mode</span>
<span class="p">;</span>                         <span class="s1">&#39;((&quot;^</span><span class="se">\\</span><span class="s1">s *</span><span class="se">\t</span><span class="s1">&quot; . &#39;</span><span class="n">my</span><span class="o">-</span><span class="n">invalid</span><span class="o">-</span><span class="n">face</span><span class="p">)</span> <span class="p">;</span> <span class="n">Leading</span> <span class="n">tabs</span>
<span class="p">;</span>                            <span class="p">(</span><span class="s2">&quot;[ </span><span class="se">\t</span><span class="s2">]+$&quot;</span> <span class="o">.</span> <span class="s1">&#39;my-invalid-face)  ; Trailing spaces</span>
<span class="p">;</span>                            <span class="p">(</span><span class="s2">&quot;^[ </span><span class="se">\t</span><span class="s2">]+$&quot;</span> <span class="o">.</span> <span class="s1">&#39;my-invalid-face)); Spaces only</span>
<span class="p">;</span>                          <span class="p">)</span>
 <span class="p">)</span>

<span class="p">(</span><span class="n">add</span><span class="o">-</span><span class="n">hook</span> <span class="s1">&#39;python-mode-hook &#39;</span><span class="n">my</span><span class="o">-</span><span class="n">python</span><span class="o">-</span><span class="n">mode</span><span class="o">-</span><span class="n">hook</span><span class="p">)</span>
</pre></div>
</div>
<p>The lines beginning with ‘;’ are comments. They can be activated
if one want to have a strong notice of some tab/space usage
violations.</p>
</div>
<div class="section" id="portability-tips">
<h2>Portability Tips<a class="headerlink" href="#portability-tips" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">breezy.osutils</span></code> module has many useful helper functions, including
some more portable variants of functions in the standard library.</p>
<p>In particular, don’t use <code class="docutils literal notranslate"><span class="pre">shutil.rmtree</span></code> unless it’s acceptable for it
to fail on Windows if some files are readonly or still open elsewhere.
Use <code class="docutils literal notranslate"><span class="pre">breezy.osutils.rmtree</span></code> instead.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">open(..).read(..)</span></code> or <code class="docutils literal notranslate"><span class="pre">open(..).write(..)</span></code> style chaining
of methods for reading or writing file content relies on garbage collection
to close the file which may keep the file open for an undefined period of
time. This may break some follow up operations like rename on Windows.
Use <code class="docutils literal notranslate"><span class="pre">try/finally</span></code> to explictly close the file. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;foo.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="dynamic-imports">
<h2>Dynamic imports<a class="headerlink" href="#dynamic-imports" title="Permalink to this headline">¶</a></h2>
<p>If you need to import a module (or attribute of a module) named in a
variable:</p>
<blockquote>
<div><ul class="simple">
<li><p>If importing a module, not an attribute, and the module is a top-level
module (i.e. has no dots in the name), then it’s ok to use the builtin
<code class="docutils literal notranslate"><span class="pre">__import__</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">__import__(module_name)</span></code>.</p></li>
<li><p>In all other cases, prefer <code class="docutils literal notranslate"><span class="pre">breezy.pyutils.get_named_object</span></code> to the
built-in <code class="docutils literal notranslate"><span class="pre">__import__</span></code>.  <code class="docutils literal notranslate"><span class="pre">__import__</span></code> has some subtleties and
unintuitive behaviours that make it hard to use correctly.</p></li>
</ul>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table of Contents</h3>
          <ul>
<li class="toctree-l1"><a class="reference internal" href="contribution-quickstart.html">Contributing to Breezy</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="profiling.html">Profiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="bug-handling.html">Tracking Bugs in Breezy</a></li>
<li class="toctree-l1"><a class="reference internal" href="HACKING.html">Breezy Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Breezy Testing Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-review.html">Reviewing proposed changes to Breezy</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Breezy Code Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="documenting-changes.html">Documenting Changes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuring Breezy</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html#breezy-conf">breezy.conf</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html#location-conf">location.conf</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html#branch-conf">branch.conf</a></li>
<li class="toctree-l1"><a class="reference internal" href="fetch.html">Fetching data</a></li>
<li class="toctree-l1"><a class="reference internal" href="transports.html">Developer guide to breezy transports</a></li>
<li class="toctree-l1"><a class="reference internal" href="ui.html">Interacting with the user</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="releasing.html">Releasing Breezy</a></li>
<li class="toctree-l1"><a class="reference internal" href="ppa.html">Managing the Breezy PPA</a></li>
<li class="toctree-l1"><a class="reference internal" href="ec2.html">Breezy Windows EC2 Server</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Breezy Architectural Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="integration.html">Integrating with Breezy</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="principles.html">Breezy Design Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="specifications.html">Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="implementation-notes.html">Implementation notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="miscellaneous-notes.html">Miscellaneous notes</a></li>
</ul>

          <div role="search">
            <h3 style="margin-top: 1.5em;">Search</h3>
            <form class="search" action="search.html" method="get">
                <input type="text" name="q" />
                <input type="submit" value="Go" />
            </form>
          </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <div role="navigation" aria-label="related navigaton">
            <a href="code-review.html" title="Reviewing proposed changes to Breezy"
              >previous</a> |
            <a href="documenting-changes.html" title="Documenting Changes"
              >next</a>
          </div>
          <div role="note" aria-label="source link">
              <br/>
              <a href="_sources/code-style.txt"
                rel="nofollow">Show Source</a>
          </div>
        </div>

        <div class="right">
          
    <div class="footer" role="contentinfo">
        &#169; Copyright 2009-2011 Canonical Ltd, 2017-2018 Breezy Developers.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>